# AI-HR智能招聘系统需求文档

## 一、项目概述

### 1.1 项目背景
AI-HR智能招聘系统是一款面向猎头顾问的智能化招聘辅助平台，通过AI技术实现职位需求解析、候选人自动搜索、智能匹配分析等功能，显著提升猎头工作效率和匹配精准度。

### 1.2 技术栈
- **前端框架**: Next.js 14+ (App Router)
- **UI组件库**: TDesign React
- **数据库**: Supabase (PostgreSQL + 实时订阅)
- **AI能力**: OpenAI API / Claude API
- **状态管理**: React Context + Zustand
- **数据请求**: TanStack Query
- **身份认证**: Supabase Auth

### 1.3 核心价值
- 将JD解析时间从30分钟缩短到1分钟
- 自动化候选人搜索，日均可处理50+候选人
- AI智能匹配提升推荐准确率30%+
- 统一管理多项目候选人池，避免重复工作

---

## 二、用户角色与使用场景

### 2.1 主要用户角色
**猎头顾问**: 系统的核心用户，负责招聘项目管理、候选人搜寻与推荐

### 2.2 典型使用流程
1. 创建招聘项目，录入或导入JD
2. AI自动提取JD关键信息
3. 设置搜索策略，启动多平台爬取
4. AI自动匹配分析候选人
5. 查看推荐列表，筛选合适候选人
6. 导出候选人报告或直接跳转平台沟通

---

## 三、功能模块设计

## 模块 1: 用户认证与工作台

### 功能 1.1 用户登录注册

**用户故事**: 作为猎头顾问,我需要创建账号并登录系统,以便安全地管理我的招聘项目和候选人数据。

#### 页面设计
- **路由**: `/login`, `/register`
- **布局**: 左右分栏,左侧品牌展示,右侧登录表单
- **组件**: 
  - `TDesign Form` - 表单容器
  - `TDesign Input` - 用户名/邮箱/密码输入
  - `TDesign Button` - 登录/注册按钮
  - `TDesign Divider` - 分隔线
  - `TDesign Link` - 忘记密码/切换登录注册

#### 验收标准
1. **注册功能**
   - When 用户填写邮箱和密码点击注册时,系统应当发送验证邮件
   - When 用户点击邮件验证链接时,系统应当激活账号并跳转登录页
   - When 密码强度不足时,系统应当实时提示密码要求(8位以上,含大小写字母和数字)

2. **登录功能**
   - When 用户输入正确凭证时,系统应当跳转到工作台首页
   - When 用户输入错误凭证时,系统应当显示清晰的错误提示
   - When 用户选择"记住我"时,系统应当保持7天登录状态

3. **第三方登录** (可选)
   - When 用户点击Google登录时,系统应当通过OAuth完成认证

#### 数据库设计
```sql
-- 使用Supabase内置的auth.users表
-- 扩展用户配置表
CREATE TABLE user_profiles (
  id UUID PRIMARY KEY REFERENCES auth.users(id),
  full_name TEXT,
  company_name TEXT,
  industry TEXT,
  phone TEXT,
  avatar_url TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);
```

---

### 功能 1.2 工作台首页

**用户故事**: 作为猎头顾问,我需要一个直观的工作台,快速了解我的项目进展和待办事项。

#### 页面设计
- **路由**: `/dashboard`
- **布局**: 响应式网格布局,顶部导航+左侧菜单+主内容区
- **组件**:
  - `TDesign Layout` - 整体布局容器
  - `TDesign Menu` - 左侧导航菜单
  - `TDesign Card` - 数据卡片展示
  - `TDesign Statistic` - 统计数字展示
  - `TDesign Table` - 最近项目列表

#### 关键信息展示
1. **统计数据区域** (顶部4个卡片)
   - 进行中的项目数量
   - 本周新增候选人数
   - 待处理匹配任务数
   - 本月推荐候选人数

2. **快速操作区域**
   - 创建新项目按钮
   - 导入JD快捷入口
   - 查看全部候选人入口

3. **最近项目列表** (表格)
   - 项目名称
   - 客户公司
   - 职位名称
   - 候选人数量
   - 最高匹配度
   - 更新时间
   - 操作按钮(查看详情/继续搜索)

#### 验收标准
1. When 用户首次登录时,系统应当显示引导教程卡片
2. When 用户有新的高匹配度候选人时,系统应当在顶部显示通知徽章
3. When 用户点击项目条目时,系统应当跳转到项目详情页
4. When 没有任何项目时,系统应当显示空状态引导创建第一个项目

---

## 模块 2: 项目与JD管理

### 功能 2.1 创建招聘项目

**用户故事**: 作为猎头顾问,我需要为每个招聘需求创建独立项目,以便分类管理不同客户的候选人。

#### 页面设计
- **路由**: `/projects/new`
- **布局**: 居中表单,步骤条引导
- **组件**:
  - `TDesign Steps` - 创建步骤指示器
  - `TDesign Form` - 项目信息表单
  - `TDesign Input` - 基础信息输入
  - `TDesign Select` - 行业/职能选择
  - `TDesign DatePicker` - 截止日期选择
  - `TDesign Upload` - JD文件上传

#### 表单字段
**步骤1: 基础信息**
- 项目名称* (必填,如"腾讯-高级Java工程师")
- 客户公司* (必填)
- 行业分类* (必填,下拉选择: 互联网/金融/制造/医疗等)
- 职能分类* (必填,下拉选择: 技术/市场/运营/财务等)
- 项目负责人 (默认当前用户)
- 项目截止日期

**步骤2: JD录入**
- 方式1: 粘贴JD文本 (`TDesign Textarea`,支持Markdown预览)
- 方式2: 输入JD链接 (自动抓取)
- 方式3: 上传JD文档 (支持PDF/Word)

**步骤3: 搜索配置**
- 目标平台选择 (多选: BOSS直聘/猎聘/智联)
- 搜索优先级 (技能优先/经验优先/学历优先)
- 匹配度阈值 (滑块: 60-90分,默认70分)

#### 验收标准
1. When 用户填写必填字段并提交时,系统应当创建项目并跳转到JD解析页
2. When 用户输入JD链接时,系统应当自动抓取页面内容并填充到文本框
3. When 用户上传JD文档时,系统应当解析文档内容并提取文本
4. When 用户未填写必填项时,系统应当高亮错误字段并阻止提交
5. When 项目创建成功时,系统应当显示成功提示并自动触发JD关键词提取

#### 数据库设计
```sql
CREATE TABLE projects (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES auth.users(id) NOT NULL,
  project_name TEXT NOT NULL,
  client_company TEXT NOT NULL,
  industry TEXT NOT NULL,
  job_function TEXT NOT NULL,
  deadline DATE,
  status TEXT DEFAULT 'active', -- active/paused/completed/archived
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE TABLE job_descriptions (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  project_id UUID REFERENCES projects(id) ON DELETE CASCADE,
  jd_source TEXT, -- text/url/file
  jd_content TEXT NOT NULL,
  jd_url TEXT,
  file_path TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

---

### 功能 2.2 AI智能JD解析

**用户故事**: 作为猎头顾问,我需要AI自动提取JD中的关键信息,节省手动整理的时间。

#### 页面设计
- **路由**: `/projects/[id]/jd-analysis`
- **布局**: 左右分栏,左侧原始JD,右侧解析结果
- **组件**:
  - `TDesign Loading` - AI解析中的加载状态
  - `TDesign Card` - 分类展示关键词
  - `TDesign Tag` - 技能标签展示
  - `TDesign Collapse` - 可折叠的详细信息面板
  - `TDesign Button` - 确认/重新解析按钮

#### 解析结果结构
1. **职位概要**
   - 职位名称
   - 工作地点
   - 薪资范围
   - 汇报对象
   - 下属人数

2. **硬性要求** (红色标签)
   - 学历要求 (如: 本科及以上)
   - 工作年限 (如: 5年以上)
   - 必备技能 (如: Java/Spring Boot/MySQL)
   - 语言要求 (如: 英语CET-6)

3. **加分项** (蓝色标签)
   - 优先技能 (如: Kubernetes/微服务架构)
   - 行业背景 (如: 互联网大厂经验)
   - 项目经验 (如: 高并发系统设计)

4. **软性素质**
   - 沟通能力
   - 团队协作
   - 学习能力
   - 抗压能力

5. **AI分析洞察**
   - 职位难度评估
   - 市场热度分析
   - 推荐搜索关键词组合

#### 验收标准
1. When AI开始解析时,系统应当显示解析进度动画(预计耗时10-30秒)
2. When AI解析完成时,系统应当按重要性排序展示关键词
3. When 用户点击关键词标签时,系统应当支持编辑或删除
4. When 用户点击"确认解析结果"时,系统应当保存数据并跳转到搜索配置页
5. When 用户点击"重新解析"时,系统应当重新调用AI接口
6. When AI解析失败时,系统应当显示错误信息并提供手动编辑选项

#### 数据库设计
```sql
CREATE TABLE jd_analysis (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  jd_id UUID REFERENCES job_descriptions(id) ON DELETE CASCADE,
  position_title TEXT,
  location TEXT,
  salary_range TEXT,
  education_requirement TEXT,
  experience_years TEXT,
  required_skills JSONB, -- ["Java", "Spring Boot"]
  preferred_skills JSONB,
  soft_skills JSONB,
  language_requirements TEXT,
  ai_insights JSONB, -- {difficulty: "medium", marketHeat: "high"}
  search_keywords JSONB, -- 推荐搜索关键词
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);
```

#### API设计
```typescript
// app/api/ai/parse-jd/route.ts
POST /api/ai/parse-jd
Request: {
  jdContent: string,
  projectId: string
}
Response: {
  success: boolean,
  data: {
    positionTitle: string,
    hardRequirements: {
      education: string,
      experience: string,
      skills: string[]
    },
    preferredSkills: string[],
    softSkills: string[],
    aiInsights: {
      difficulty: 'easy' | 'medium' | 'hard',
      marketHeat: 'low' | 'medium' | 'high',
      suggestedKeywords: string[]
    }
  }
}
```

---

## 模块 3: 候选人搜索与采集

### 功能 3.1 搜索任务配置

**用户故事**: 作为猎头顾问,我需要灵活配置搜索策略,在不同平台上精准搜索候选人。

#### 页面设计
- **路由**: `/projects/[id]/search-config`
- **布局**: 卡片式表单,实时预览搜索参数
- **组件**:
  - `TDesign Form` - 搜索配置表单
  - `TDesign Checkbox` - 平台多选
  - `TDesign Slider` - 匹配度阈值
  - `TDesign InputNumber` - 数量限制
  - `TDesign Radio` - 搜索模式选择
  - `TDesign Switch` - 高级选项开关

#### 配置项
1. **目标平台** (多选)
   - ☑ BOSS直聘 (推荐,候选人活跃度高)
   - ☑ 猎聘网 (中高端人才)
   - ☑ 智联招聘 (覆盖面广)
   - 每个平台显示预估候选人数量

2. **搜索关键词** (自动填充+可编辑)
   - 主关键词 (从JD解析结果自动填充)
   - 次要关键词
   - 排除关键词 (如: 实习生/应届生)

3. **筛选条件**
   - 工作年限: 滑块范围选择(0-20年)
   - 学历要求: 下拉多选
   - 当前状态: 在职/离职/在职看机会
   - 地域限制: 城市多选

4. **采集策略**
   - 每平台采集数量: 输入框(10-200,默认50)
   - 匹配度阈值: 滑块(60-90分,默认70分)
   - 去重策略: 开关(跨平台去重/保留重复)

5. **高级选项** (折叠面板)
   - 使用代理: 开关+代理配置
   - 采集间隔: 输入框(秒,防止反爬)
   - 手动Cookie: 文本框(可选,提高成功率)

#### 验收标准
1. When 用户选择平台时,系统应当显示该平台的预估候选人数量
2. When 用户调整匹配度阈值时,系统应当实时显示预计通过筛选的候选人数
3. When 用户点击"开始搜索"时,系统应当验证配置并创建搜索任务
4. When 配置无效时(如未选择平台),系统应当阻止提交并提示错误
5. When 用户保存配置时,系统应当支持保存为模板供后续项目使用

#### 数据库设计
```sql
CREATE TABLE search_tasks (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  project_id UUID REFERENCES projects(id) ON DELETE CASCADE,
  platforms JSONB NOT NULL, -- ["boss", "liepin", "zhilian"]
  keywords JSONB NOT NULL, -- {primary: [], secondary: [], exclude: []}
  filters JSONB, -- {experience: [3,5], education: [], location: []}
  collection_limit INTEGER DEFAULT 50,
  match_threshold INTEGER DEFAULT 70,
  use_proxy BOOLEAN DEFAULT false,
  crawl_interval INTEGER DEFAULT 3,
  status TEXT DEFAULT 'pending', -- pending/running/completed/failed/paused
  progress INTEGER DEFAULT 0, -- 0-100
  total_found INTEGER DEFAULT 0,
  total_collected INTEGER DEFAULT 0,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  started_at TIMESTAMPTZ,
  completed_at TIMESTAMPTZ
);
```

---

### 功能 3.2 实时搜索进度监控

**用户故事**: 作为猎头顾问,我需要实时查看搜索进度,了解各平台的采集情况。

#### 页面设计
- **路由**: `/projects/[id]/search-progress`
- **布局**: 全屏进度监控页,可最小化
- **组件**:
  - `TDesign Progress` - 总体进度条
  - `TDesign Card` - 各平台进度卡片
  - `TDesign Timeline` - 实时日志时间轴
  - `TDesign Badge` - 状态徽章
  - `TDesign Button` - 暂停/继续/停止按钮

#### 展示内容
1. **总体进度区域**
   - 大型环形进度条(显示百分比)
   - 已找到候选人数 / 目标数量
   - 已采集 / 已分析 / 推荐数量
   - 预计剩余时间

2. **平台进度卡片** (并排3个)
   - 平台Logo + 名称
   - 进度条
   - 状态: 等待中/搜索中/已完成/失败
   - 已找到数量
   - 当前操作: "正在搜索第3页..."

3. **实时日志** (右侧时间轴)
   ```
   14:23:45 [BOSS] 开始搜索...
   14:23:48 [BOSS] 找到32个候选人
   14:23:50 [BOSS] 正在采集第1个候选人详情
   14:24:02 [BOSS] 采集成功: 张三 - Java工程师
   14:24:05 [猎聘] 开始搜索...
   ```

4. **控制按钮**
   - 暂停搜索 (保存当前进度)
   - 继续搜索
   - 停止任务 (不可恢复)
   - 最小化窗口 (后台继续)

#### 验收标准
1. When 搜索任务启动时,系统应当实时推送进度更新(WebSocket或Supabase实时订阅)
2. When 某平台搜索完成时,系统应当更新该平台状态为"已完成"
3. When 用户点击"暂停"时,系统应当保存当前进度并停止采集
4. When 用户点击"最小化"时,系统应当缩小为浮动窗口但继续显示进度
5. When 所有平台采集完成时,系统应当显示完成提示并自动跳转到候选人列表页
6. When 遇到错误时,系统应当在日志中显示红色错误信息

#### 实时通信设计
```typescript
// 使用Supabase Realtime订阅任务进度
const subscription = supabase
  .channel('search-progress')
  .on('postgres_changes', 
    { 
      event: 'UPDATE', 
      schema: 'public', 
      table: 'search_tasks',
      filter: `id=eq.${taskId}`
    }, 
    (payload) => {
      // 更新UI进度
    }
  )
  .subscribe();
```

---

### 功能 3.3 候选人数据采集服务

**用户故事**: 作为系统,我需要稳定可靠地从各招聘平台采集候选人数据,并处理反爬机制。

#### 技术实现 (后端逻辑)
- **路由**: `/api/crawler/[platform]`
- **采集方式**: 
  - 优先: Puppeteer无头浏览器(模拟真实用户)
  - 备选: Playwright(更稳定)
  - 轻量: Cheerio(静态页面解析)

#### 采集流程
1. **初始化浏览器**
   ```typescript
   - 设置User-Agent
   - 加载Cookie(如果用户提供)
   - 配置代理IP(如果启用)
   - 设置随机延时
   ```

2. **搜索候选人列表**
   ```typescript
   - 构造搜索URL(基于关键词)
   - 访问搜索结果页
   - 解析候选人列表(姓名/职位/公司/标签)
   - 提取详情页链接
   - 翻页处理(最多10页)
   ```

3. **采集候选人详情**
   ```typescript
   - 访问详情页
   - 等待内容加载(最多10秒)
   - 解析简历信息:
     - 基本信息(姓名/年龄/学历/当前公司)
     - 工作经历(公司/职位/时间/描述)
     - 项目经验
     - 技能标签
     - 教育背景
   - 转换为Markdown格式
   - 存储到数据库
   ```

4. **反爬处理**
   ```typescript
   - 检测验证码: 暂停任务,记录日志
   - IP被封: 自动切换代理
   - 频率限制: 增加随机延时(3-10秒)
   - 异常重试: 最多3次,失败后跳过
   ```

#### 数据库设计
```sql
CREATE TABLE candidates (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  search_task_id UUID REFERENCES search_tasks(id),
  project_id UUID REFERENCES projects(id),
  platform TEXT NOT NULL, -- boss/liepin/zhilian
  platform_id TEXT, -- 平台上的候选人ID
  name TEXT NOT NULL,
  age INTEGER,
  gender TEXT,
  education TEXT,
  current_company TEXT,
  current_position TEXT,
  work_years INTEGER,
  expected_salary TEXT,
  location TEXT,
  tags JSONB, -- 技能标签
  resume_markdown TEXT, -- 简历全文(Markdown)
  resume_html TEXT, -- 简历HTML(备用)
  profile_url TEXT, -- 原平台链接
  avatar_url TEXT,
  status TEXT DEFAULT 'pending', -- pending/analyzing/analyzed/recommended/rejected
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(platform, platform_id) -- 防止重复采集
);

CREATE TABLE work_experiences (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  candidate_id UUID REFERENCES candidates(id) ON DELETE CASCADE,
  company_name TEXT NOT NULL,
  position TEXT NOT NULL,
  start_date DATE,
  end_date DATE,
  is_current BOOLEAN DEFAULT false,
  description TEXT,
  achievements JSONB,
  sort_order INTEGER
);

CREATE TABLE education_backgrounds (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  candidate_id UUID REFERENCES candidates(id) ON DELETE CASCADE,
  school_name TEXT NOT NULL,
  degree TEXT,
  major TEXT,
  start_date DATE,
  end_date DATE,
  sort_order INTEGER
);
```

#### 验收标准
1. When 采集候选人时,系统应当保存完整简历信息
2. When 遇到重复候选人时(同平台ID),系统应当跳过采集
3. When 检测到验证码时,系统应当暂停任务并通知用户
4. When 代理IP失效时,系统应当自动切换到下一个可用代理
5. When 采集成功后,系统应当自动触发AI匹配分析任务
6. When 采集失败时,系统应当记录错误日志,包括失败原因和候选人URL

---

## 模块 4: AI智能匹配分析

### 功能 4.1 自动匹配评分

**用户故事**: 作为猎头顾问,我需要AI自动分析候选人与JD的匹配度,快速筛选出最合适的人选。

#### 技术实现
- **触发时机**: 候选人采集完成后自动触发
- **API路由**: `/api/ai/match-analysis`
- **AI模型**: Claude 3.5 Sonnet / GPT-4

#### 匹配分析维度
1. **技能匹配** (权重40%)
   - 必备技能覆盖率
   - 技能熟练度评估(基于项目经验)
   - 技术栈相似度

2. **经验匹配** (权重30%)
   - 工作年限匹配
   - 行业经验相关性
   - 公司规模/类型匹配
   - 项目复杂度评估

3. **学历匹配** (权重15%)
   - 学历层次
   - 专业相关性
   - 院校背景

4. **稳定性评估** (权重10%)
   - 跳槽频率分析
   - 平均任职时长
   - 职业发展路径

5. **潜力评估** (权重5%)
   - 学习能力(新技术掌握速度)
   - 职位晋升速度
   - 项目亮点

#### AI Prompt设计
```typescript
const matchPrompt = `
你是一位资深的猎头顾问,请分析以下候选人是否匹配该职位。

【职位要求】
${jdAnalysis}

【候选人简历】
${candidateResume}

请按以下JSON格式输出分析结果:
{
  "overallScore": 85, // 总分0-100
  "dimensionScores": {
    "skills": 90,
    "experience": 85,
    "education": 80,
    "stability": 75,
    "potential": 88
  },
  "matchedPoints": [
    "精通Java和Spring Boot,有5年以上开发经验",
    "有大型互联网公司背景,参与过千万级用户系统",
    "本科学历,计算机相关专业"
  ],
  "gaps": [
    "缺少Kubernetes生产环境经验",
    "没有金融行业背景"
  ],
  "highlights": [
    "主导过微服务架构改造,性能提升300%",
    "开源项目贡献者,技术热情高"
  ],
  "recommendation": "强烈推荐", // 强烈推荐/推荐/考虑/不推荐
  "summary": "该候选人技术能力扎实,项目经验丰富,与职位要求高度匹配。虽然缺少部分加分项,但核心能力完全满足,建议优先安排面试。"
}
`;
```

#### 数据库设计
```sql
CREATE TABLE match_analysis (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  candidate_id UUID REFERENCES candidates(id) ON DELETE CASCADE,
  jd_analysis_id UUID REFERENCES jd_analysis(id),
  overall_score INTEGER NOT NULL, -- 0-100
  dimension_scores JSONB, -- {skills: 90, experience: 85...}
  matched_points JSONB, -- 匹配点数组
  gaps JSONB, -- 不足之处
  highlights JSONB, -- 亮点
  recommendation TEXT, -- 推荐等级
  summary TEXT, -- 分析总结
  ai_model TEXT, -- 使用的AI模型
  analysis_duration INTEGER, -- 分析耗时(秒)
  created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_match_score ON match_analysis(overall_score DESC);
CREATE INDEX idx_match_candidate ON match_analysis(candidate_id);
```

#### 验收标准
1. When 候选人采集完成时,系统应当在30秒内完成匹配分析
2. When 匹配度≥设定阈值时,系统应当标记候选人为"推荐"
3. When 匹配度<阈值时,系统应当标记为"不推荐"但仍保存分析结果
4. When AI分析失败时,系统应当重试最多3次,失败后标记为"分析失败"
5. When 分析完成时,系统应当更新候选人状态并在候选人列表中显示分数

---

## 模块 5: 候选人管理与展示

### 功能 5.1 候选人列表页

**用户故事**: 作为猎头顾问,我需要查看所有候选人的列表,快速筛选和排序,找到最合适的人选。

#### 页面设计
- **路由**: `/projects/[id]/candidates`
- **布局**: 左侧筛选器+右侧列表+顶部工具栏
- **组件**:
  - `TDesign Table` - 候选人表格(虚拟滚动)
  - `TDesign Filter` - 筛选器面板
  - `TDesign Select` - 排序选择
  - `TDesign Tag` - 技能标签
  - `TDesign Button` - 批量操作按钮
  - `TDesign Pagination` - 分页器

#### 表格列设计
| 列名 | 宽度 | 内容 | 可排序 |
|------|------|------|--------|
| 选择框 | 50px | 复选框 | - |
| 匹配度 | 80px | 大号分数+评级徽章 | ✓ |
| 姓名 | 120px | 姓名+性别+年龄 | - |
| 当前状态 | 150px | 公司-职位 | - |
| 技能标签 | 200px | 前5个关键技能Tag | - |
| 工作年限 | 80px | X年 | ✓ |
| 学历 | 80px | 本科/硕士 | ✓ |
| 来源平台 | 80px | 平台Logo | - |
| 更新时间 | 120px | X天前 | ✓ |
| 操作 | 120px | 查看详情/跳转平台 | - |

#### 筛选器功能
1. **快速筛选** (顶部标签)
   - 全部候选人
   - 强烈推荐 (≥90分)
   - 推荐 (70-89分)
   - 待定 (<70分)
   - 已联系
   - 已推荐给客户

2. **高级筛选** (左侧面板)
   - 匹配度范围: 双向滑块
   - 技能标签: 多选下拉(来自JD关键词)
   - 工作年限: 范围选择
   - 学历: 多选
   - 当前状态: 在职/离职/在职看机会
   - 来源平台: 多选
   - 地域: 城市多选

3. **排序选项**
   - 匹配度从高到低(默认)
   - 更新时间最新
   - 工作年限从高到低
   - 姓名A-Z

#### 批量操作
- 批量标记: 已联系/面试中/已推荐/已淘汰
- 批量导出: Excel/PDF报告
- 批量分组: 移动到候选人池

#### 验收标准
1. When 页面加载时,系统应当默认按匹配度排序显示候选人
2. When 候选人超过100个时,系统应当使用虚拟滚动优化性能
3. When 用户选择筛选条件时,系统应当实时更新列表(防抖300ms)
4. When 点击候选人行时,系统应当在侧边抽屉中显示快速预览
5. When 点击"查看详情"时,系统应当打开详情页
6. When 点击"跳转平台"时,系统应当在新标签页打开原平台链接
7. When 没有候选人时,系统应当显示空状态引导去搜索

#### 性能优化
```typescript
// 使用TanStack Query做数据缓存和无限滚动
const { data, fetchNextPage, hasNextPage } = useInfiniteQuery({
  queryKey: ['candidates', projectId, filters],
  queryFn: ({ pageParam = 0 }) => fetchCandidates(projectId, {
    ...filters,
    offset: pageParam,
    limit: 50
  }),
  getNextPageParam: (lastPage, pages) => 
    lastPage.hasMore ? pages.length * 50 : undefined
});
```

---

### 功能 5.2 候选人详情页

**用户故事**: 作为猎头顾问,我需要查看候选人的完整简历和详细匹配分析,做出是否推荐的决策。

#### 页面设计
- **路由**: `/projects/[id]/candidates/[candidateId]`
- **布局**: 三栏布局
  - 左侧: 个人信息卡片(固定)
  - 中间: 简历详情(可滚动)
  - 右侧: 匹配分析(固定)
- **组件**:
  - `TDesign Card` - 信息卡片
  - `TDesign Tabs` - 简历/分析报告切换
  - `TDesign Timeline` - 工作经历时间轴
  - `TDesign Progress` - 各维度匹配进度条
  - `TDesign Comment` - 备注评论组件
  - `TDesign Dropdown` - 更多操作菜单

#### 左侧个人信息卡片
- 头像(如果有)/默认头像
- 姓名、性别、年龄
- 当前公司-职位
- 工作年限
- 最高学历
- 期望薪资
- 所在城市
- 联系状态徽章
- 操作按钮:
  - 标记为"已联系"
  - 添加到候选人池
  - 推荐给客户
  - 导出简历PDF
  - 跳转平台(主按钮)

#### 中间简历详情区域 (Tabs切换)

**Tab1: 完整简历**
1. 个人优势/自我评价
2. 工作经历 (Timeline组件)
   - 公司Logo(如有)
   - 公司名称-职位
   - 在职时间(X年X月)
   - 工作描述(Markdown渲染)
   - 项目亮点(高亮显示)
3. 项目经验
4. 教育背景
5. 技能清单(Tag云)
6. 语言能力
7. 证书/荣誉

**Tab2: 匹配分析报告**
- 总分大号展示(环形进度图)
- 推荐等级标签
- 各维度评分(雷达图或进度条)
- 匹配优势(绿色卡片)
  - 每项匹配点带✓图标
- 不足之处(黄色卡片)
  - 每项差距带⚠图标
- 候选人亮点(蓝色卡片)
  - 每项亮点带★图标
- AI总结段落

**Tab3: 操作记录**
- 时间轴展示:
  - 采集时间
  - 分析时间
  - 标记状态变更
  - 备注添加
  - 推荐操作

#### 右侧快速操作面板
1. **状态管理**
   - 当前状态下拉选择
   - 状态选项: 待处理/已联系/面试中/已推荐/已淘汰/已入职

2. **添加备注**
   - 文本框输入
   - 支持@团队成员
   - 历史备注列表

3. **相似候选人推荐**
   - "查找相似背景"按钮
   - 展示3个相似候选人卡片

#### 验收标准
1. When 页面加载时,系统应当同时加载候选人信息、简历详情和匹配分析
2. When 简历内容包含Markdown格式时,系统应当正确渲染格式
3. When 用户切换Tab时,系统应当有平滑的过渡动画
4. When 用户点击"跳转平台"时,系统应当记录操作并在新窗口打开链接
5. When 用户修改状态时,系统应当实时更新并显示操作成功提示
6. When 用户添加备注时,系统应当即时保存并显示在历史列表中
7. When 点击"查找相似候选人"时,系统应当基于技能和经验推荐相似人选

#### 数据库设计
```sql
CREATE TABLE candidate_notes (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  candidate_id UUID REFERENCES candidates(id) ON DELETE CASCADE,
  user_id UUID REFERENCES auth.users(id),
  content TEXT NOT NULL,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE TABLE candidate_status_history (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  candidate_id UUID REFERENCES candidates(id) ON DELETE CASCADE,
  user_id UUID REFERENCES auth.users(id),
  from_status TEXT,
  to_status TEXT NOT NULL,
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

---

### 功能 5.3 候选人池管理

**用户故事**: 作为猎头顾问,我需要维护一个长期的候选人池,按行业/职能分类管理候选人,方便跨项目复用。

#### 页面设计
- **路由**: `/talent-pool`
- **布局**: 左侧分类树+右侧候选人网格视图
- **组件**:
  - `TDesign Tree` - 分类树
  - `TDesign Card` - 候选人卡片
  - `TDesign Input` - 搜索框
  - `TDesign Drawer` - 添加分类抽屉

#### 分类体系
```
📁 全部候选人 (523)
├─ 📂 按行业分类
│  ├─ 互联网 (245)
│  ├─ 金融 (89)
│  ├─ 制造业 (67)
│  └─ 医疗健康 (45)
├─ 📂 按职能分类
│  ├─ 技术研发 (312)
│  │  ├─ 后端开发 (156)
│  │  ├─ 前端开发 (89)
│  │  └─ 算法工程师 (67)
│  ├─ 产品设计 (78)
│  └─ 市场运营 (45)
├─ 📂 按经验层级
│  ├─ 初级(1-3年) (123)
│  ├─ 中级(3-7年) (234)
│  └─ 高级(7年+) (166)
└─ 📂 我的标签
   ├─ ⭐ 明星候选人 (23)
   ├─ 💰 薪资敏感 (45)
   └─ 🚀 快速到岗 (34)
```

#### 候选人卡片视图
- 头像/默认图标
- 姓名+当前职位
- 核心技能标签(3个)
- 工作年限+学历
- 最近联系时间
- 快速操作按钮:
  - 查看详情
  - 添加到项目
  - 编辑标签

#### 功能操作
1. **搜索**
   - 支持姓名/公司/技能关键词搜索
   - 搜索历史保存

2. **分类管理**
   - 创建自定义分类
   - 拖拽候选人到分类
   - 一个候选人可属于多个分类

3. **批量导入**
   - 从历史项目批量添加
   - 从Excel导入候选人

4. **跨项目推荐**
   - "为当前项目推荐"按钮
   - 自动匹配合适候选人到新项目

#### 验收标准
1. When 用户点击分类时,系统应当加载该分类下的候选人
2. When 用户拖拽候选人到分类时,系统应当更新候选人分类并显示成功提示
3. When 用户创建新分类时,系统应当实时更新分类树
4. When 用户搜索候选人时,系统应当高亮匹配关键词
5. When 候选人池为空时,系统应当显示引导添加候选人的空状态

#### 数据库设计
```sql
CREATE TABLE talent_pool_categories (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES auth.users(id),
  name TEXT NOT NULL,
  parent_id UUID REFERENCES talent_pool_categories(id),
  category_type TEXT, -- industry/function/level/custom
  icon TEXT,
  sort_order INTEGER,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE TABLE talent_pool_members (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  candidate_id UUID REFERENCES candidates(id),
  category_id UUID REFERENCES talent_pool_categories(id),
  user_id UUID REFERENCES auth.users(id),
  added_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(candidate_id, category_id)
);
```

---

## 模块 6: 数据导出与报告

### 功能 6.1 候选人报告导出

**用户故事**: 作为猎头顾问,我需要导出精美的候选人推荐报告给客户,展示候选人信息和匹配分析。

#### 页面设计
- **路由**: `/projects/[id]/export`
- **布局**: 预览页+配置面板
- **组件**:
  - `TDesign Form` - 导出配置
  - `TDesign Checkbox` - 候选人多选
  - `TDesign Radio` - 模板选择
  - `TDesign Button` - 导出按钮

#### 导出配置
1. **选择候选人**
   - 全选推荐候选人
   - 自定义选择
   - 候选人预览列表(带匹配度)

2. **选择模板**
   - 简洁版(仅关键信息)
   - 标准版(完整简历+分析)
   - 详细版(含项目经验)

3. **内容配置**
   - ☑ 包含匹配分析
   - ☑ 包含工作经历
   - ☑ 包含项目经验
   - ☑ 包含教育背景
   - ☐ 包含联系方式(敏感信息)
   - ☑ 显示匹配度评分

4. **品牌定制**
   - 添加公司Logo
   - 自定义封面标题
   - 添加公司简介
   - 选择配色方案

#### 导出格式
- **PDF** (推荐,保持格式)
  - 生成精美排版的PDF文档
  - 每个候选人独立一页
  - 包含目录和页码
- **Excel** (数据分析用)
  - 候选人信息表
  - 匹配分析汇总表
- **Word** (可编辑)
  - 可进一步编辑的文档

#### 报告结构 (PDF标准版)
```
封面
- 项目名称
- 候选人推荐报告
- 日期
- 公司Logo

目录
- 候选人列表(带匹配度)

候选人详情页 (每人一页)
- 个人信息摘要
- 匹配度雷达图
- 核心优势
- 工作经历
- 教育背景
- 技能清单
- 匹配分析总结
```

#### 验收标准
1. When 用户选择导出格式并点击导出时,系统应当在30秒内生成文件
2. When 导出PDF时,系统应当确保中文字体正常显示
3. When 导出Excel时,系统应当包含多个Sheet(候选人/分析/汇总)
4. When 包含敏感信息时,系统应当显示警告提示
5. When 生成完成时,系统应当提供下载链接并保存7天
6. When 导出失败时,系统应当显示错误信息并提供重试选项

#### API设计
```typescript
// app/api/export/report/route.ts
POST /api/export/report
Request: {
  projectId: string,
  candidateIds: string[],
  template: 'simple' | 'standard' | 'detailed',
  format: 'pdf' | 'excel' | 'word',
  options: {
    includeAnalysis: boolean,
    includeContact: boolean,
    customLogo: string,
    colorScheme: string
  }
}
Response: {
  success: boolean,
  downloadUrl: string,
  expiresAt: string
}
```

---

## 模块 7: 系统设置与安全

### 功能 7.1 爬虫配置管理

**用户故事**: 作为猎头顾问,我需要配置爬虫参数,保证账号安全和数据采集稳定性。

#### 页面设计
- **路由**: `/settings/crawler`
- **布局**: 标签页分组(各平台独立配置)
- **组件**:
  - `TDesign Tabs` - 平台切换
  - `TDesign Form` - 配置表单
  - `TDesign Switch` - 开关控制
  - `TDesign Input` - 文本输入
  - `TDesign Alert` - 警告提示

#### 配置项 (以BOSS直聘为例)
1. **账号配置**
   - Cookie字符串 (大文本框,密码显示)
   - Token (如果需要)
   - 最后更新时间
   - "测试连接"按钮

2. **代理设置**
   - 启用代理: 开关
   - 代理类型: HTTP/SOCKS5
   - 代理地址列表 (一行一个)
   - 自动轮换: 开关
   - 测试所有代理按钮

3. **频率控制**
   - 搜索间隔: 输入框(秒,默认5)
   - 详情页间隔: 输入框(秒,默认3)
   - 每日采集上限: 输入框(默认200)
   - 当前已用: 进度条显示

4. **风险控制**
   - 遇到验证码: 下拉选择(暂停任务/跳过/通知我)
   - IP被封处理: 下拉选择(切换代理/停止任务)
   - 异常重试次数: 输入框(默认3)

#### 验收标准
1. When 用户输入Cookie时,系统应当点击"测试连接"验证有效性
2. When Cookie无效时,系统应当显示错误提示并提供更新指引
3. When 用户启用代理时,系统应当验证代理可用性
4. When 用户保存配置时,系统应当加密存储敏感信息
5. When 达到每日采集上限时,系统应当自动停止新任务

#### 数据库设计
```sql
CREATE TABLE crawler_configs (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES auth.users(id),
  platform TEXT NOT NULL, -- boss/liepin/zhilian
  cookies TEXT, -- 加密存储
  tokens JSONB, -- 加密存储
  proxy_enabled BOOLEAN DEFAULT false,
  proxy_list JSONB,
  search_interval INTEGER DEFAULT 5,
  detail_interval INTEGER DEFAULT 3,
  daily_limit INTEGER DEFAULT 200,
  daily_used INTEGER DEFAULT 0,
  last_reset_date DATE DEFAULT CURRENT_DATE,
  is_active BOOLEAN DEFAULT true,
  updated_at TIMESTAMPTZ DEFAULT NOW()
);
```

---

### 功能 7.2 用户偏好设置

**用户故事**: 作为猎头顾问,我需要个性化设置系统偏好,提升使用体验。

#### 配置项
1. **通知设置**
   - ☑ 搜索任务完成通知
   - ☑ 发现高匹配度候选人通知
   - ☐ 每日数据汇总邮件
   - ☐ 账号风险预警

2. **默认值设置**
   - 默认匹配度阈值: 滑块
   - 默认每平台采集数量: 输入框
   - 默认搜索平台: 多选

3. **显示偏好**
   - 列表密度: 紧凑/标准/宽松
   - 主题模式: 浅色/深色/跟随系统
   - 语言: 简体中文/English

4. **数据管理**
   - 导出全部数据
   - 清空候选人池
   - 删除账号(危险操作)

---

## 四、技术架构设计

### 4.1 项目结构
```
ai-hr-system/
├── app/
│   ├── (auth)/
│   │   ├── login/
│   │   └── register/
│   ├── (dashboard)/
│   │   ├── dashboard/
│   │   ├── projects/
│   │   │   ├── [id]/
│   │   │   │   ├── jd-analysis/
│   │   │   │   ├── search-config/
│   │   │   │   ├── search-progress/
│   │   │   │   ├── candidates/
│   │   │   │   └── export/
│   │   │   └── new/
│   │   ├── talent-pool/
│   │   └── settings/
│   ├── api/
│   │   ├── ai/
│   │   │   ├── parse-jd/
│   │   │   └── match-analysis/
│   │   ├── crawler/
│   │   │   ├── boss/
│   │   │   ├── liepin/
│   │   │   └── zhilian/
│   │   ├── export/
│   │   └── projects/
│   └── layout.tsx
├── components/
│   ├── layout/
│   ├── candidates/
│   ├── projects/
│   └── common/
├── lib/
│   ├── supabase/
│   ├── ai/
│   ├── crawler/
│   └── utils/
├── types/
└── public/
```

### 4.2 核心依赖
```json
{
  "dependencies": {
    "next": "^14.0.0",
    "react": "^18.2.0",
    "tdesign-react": "^1.7.0",
    "@supabase/supabase-js": "^2.39.0",
    "@supabase/auth-helpers-nextjs": "^0.8.0",
    "@tanstack/react-query": "^5.0.0",
    "zustand": "^4.4.0",
    "puppeteer": "^21.0.0",
    "cheerio": "^1.0.0-rc.12",
    "ai": "^3.0.0",
    "pdf-lib": "^1.17.1",
    "xlsx": "^0.18.5",
    "zod": "^3.22.0"
  }
}
```

### 4.3 Supabase数据库策略
1. **Row Level Security (RLS)**
   - 所有表启用RLS
   - 用户只能访问自己创建的数据
   ```sql
   ALTER TABLE projects ENABLE ROW LEVEL SECURITY;
   
   CREATE POLICY "Users can only access their own projects"
   ON projects FOR ALL
   USING (user_id = auth.uid());
   ```

2. **实时订阅**
   - 搜索任务进度实时更新
   - 候选人匹配完成通知
   ```typescript
   const subscription = supabase
     .channel('search-progress')
     .on('postgres_changes', 
       { event: 'UPDATE', schema: 'public', table: 'search_tasks' },
       (payload) => handleProgressUpdate(payload)
     )
     .subscribe();
   ```

3. **存储桶配置**
   - `avatars`: 用户头像
   - `candidate-resumes`: 简历文件
   - `export-reports`: 导出的报告文件

---

## 五、开发优先级与里程碑

### Phase 1: MVP核心功能 (2周)
- [x] 用户认证 (Supabase Auth)
- [x] 项目创建与管理
- [x] JD录入与AI解析
- [x] 单平台爬虫(BOSS直聘)
- [x] 基础候选人列表展示

### Phase 2: 智能匹配 (1周)
- [ ] AI匹配分析引擎
- [ ] 候选人详情页
- [ ] 匹配度排序与筛选

### Phase 3: 多平台采集 (1周)
- [ ] 猎聘网爬虫
- [ ] 智联招聘爬虫
- [ ] 代理IP池管理
- [ ] 反爬处理优化

### Phase 4: 高级功能 (1周)
- [ ] 候选人池管理
- [ ] 报告导出(PDF/Excel)
- [ ] 搜索任务实时监控
- [ ] 系统设置与配置

### Phase 5: 优化与发布 (1周)
- [ ] 性能优化(虚拟滚动/缓存)
- [ ] 错误处理与日志
- [ ] 用户引导与帮助文档
- [ ] 生产环境部署

---

## 六、非功能性需求

### 6.1 性能要求
- 页面首次加载: <3秒
- JD解析: <30秒
- 候选人匹配分析: <30秒/人
- 列表滚动: 60fps流畅
- 支持并发搜索3个平台

### 6.2 安全要求
- 所有敏感数据(Cookie/Token)加密存储
- API接口需要身份认证
- SQL注入防护
- XSS防护
- CSRF Token验证

### 6.3 兼容性
- 浏览器: Chrome 90+, Edge 90+, Safari 14+
- 分辨率: 1366x768 及以上
- 移动端: 响应式适配(Pad优先)

### 6.4 数据备份
- Supabase自动备份(每日)
- 用户数据导出功能
- 操作日志保留30天

---

## 七、风险与应对

### 风险1: 招聘平台反爬升级
**应对**: 
- 使用无头浏览器模拟真实用户
- 提供手动Cookie配置
- 预留人工验证码处理流程

### 风险2: AI分析成本过高
**应对**:
- 实现结果缓存(相同JD+候选人不重复分析)
- 使用更经济的模型(GPT-4o-mini)
- 分批处理降低并发成本

### 风险3: 数据隐私合规
**应对**:
- 加密存储所有敏感信息
- 提供数据删除功能
- 明确用户协议与隐私政策

---

## 八、后续扩展方向

1. **AI面试助手**: 根据候选人背景生成面试问题
2. **自动化跟进**: 定时发送候选人状态提醒
3. **团队协作**: 多用户共享候选人池
4. **数据分析**: 招聘漏斗分析,候选人来源分析
5. **移动端App**: 随时随地查看候选人
6. **API开放**: 与ATS系统集成

---